<!DOCTYPE html>
<html>
<head>
  <title>Ramuduâ€“Sita Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <style>
    :root{
      --bg:#000;
      --card:#111;
      --accent:#ff9800;
      --text:#fff;
      --muted:#aaa;
    }

    *{
      box-sizing:border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display:flex;
      justify-content:center;
    }

    .app{
      width:100%;
      max-width:420px;
      padding:16px;
    }

    h1{
      text-align:center;
      margin:10px 0 20px;
      font-size:22px;
    }

    .card{
      background:var(--card);
      border-radius:14px;
      padding:16px;
      margin-bottom:14px;
      box-shadow:0 0 0 1px #222;
    }

    input{
      width:100%;
      padding:14px;
      font-size:16px;
      border-radius:10px;
      border:none;
      outline:none;
      margin-bottom:12px;
    }

    button{
      width:100%;
      padding:14px;
      font-size:16px;
      border:none;
      border-radius:12px;
      background:var(--accent);
      color:#000;
      font-weight:600;
      cursor:pointer;
      margin-top:8px;
    }

    button.secondary{
      background:#333;
      color:#fff;
    }

    button.danger{
      background:#c62828;
      color:#fff;
    }

    .row{
      display:flex;
      gap:10px;
    }

    .row button{
      flex:1;
    }

    #game{ display:none; }

    .status{
      text-align:center;
      font-size:15px;
      color:var(--muted);
      margin-bottom:10px;
    }

    .role{
      text-align:center;
      font-size:20px;
      font-weight:700;
      margin:10px 0;
    }

    .timer{
      text-align:center;
      font-size:18px;
      color:#ff5252;
      margin-bottom:10px;
    }

    .player-list button{
      margin-top:6px;
    }

    .scores{
      font-size:14px;
      line-height:1.6;
      margin-top:10px;
    }

    /* Sticky bottom actions (mobile friendly) */
    .sticky{
      position:sticky;
      bottom:0;
      background:linear-gradient(transparent, #000 40%);
      padding-top:10px;
    }

    @media (min-width:768px){
      h1{ font-size:26px; }
    }
  </style>
</head>

<body>
<div class="app">

  <h1>ðŸŽ® Ramuduâ€“Sita Game</h1>

  <!-- JOIN -->
  <div class="card">
    <input id="name" placeholder="Enter your name">
    <button onclick="joinGame()">Join Game</button>
  </div>

  <!-- GAME -->
  <div id="game">

    <div class="card">
      <div class="status" id="status">Waiting for playersâ€¦</div>
      <div class="role" id="myrole"></div>
      <div class="timer" id="timer"></div>

      <div class="row">
        <button onclick="startGame()">Start Game</button>
        <button class="secondary" onclick="resetAllPlayers()">Reset All</button>
      </div>
    </div>

    <!-- Rama Panel -->
    <div class="card" id="ramaPanel" style="display:none">
      <h3 style="margin-top:0">Select Sita</h3>
      <div class="player-list" id="playerList"></div>
    </div>

    <!-- Scores -->
    <div class="card">
      <div class="scores" id="score"></div>
    </div>

    <!-- Bottom actions -->
    <div class="sticky">
      <button class="danger" onclick="leaveGame()">Leave Game</button>
    </div>

  </div>
</div>

<script>
/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyAgW8uCRYRt9vQR59tcZKPZ5frkIdUtzIA",
  authDomain: "ramudu-game.firebaseapp.com",
  databaseURL: "https://ramudu-game-default-rtdb.firebaseio.com",
  projectId: "ramudu-game",
  storageBucket: "ramudu-game.firebasestorage.app",
  messagingSenderId: "1024983133761",
  appId: "1:1024983133761:web:bd97cd6a42b09daad260c0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let uid="", playerName="", timerInt=null;

/* Role order */
const roleOrder = [
  {name:"rama",score:0},
  {name:"sita",score:0},
  {name:"lakshmana",score:900},
  {name:"hanuman",score:800},
  {name:"baratha",score:700},
  {name:"satrugunudu",score:600},
  {name:"jambavanta",score:500},
  {name:"sugrivudu",score:400},
  {name:"vali",score:300}
];

auth.signInAnonymously().then(r=>uid=r.user.uid);

function joinGame(){
  playerName=document.getElementById("name").value.trim();
  if(!playerName) return alert("Enter name");

  db.ref("players/"+uid).set({name:playerName,role:"",score:0});
  document.getElementById("game").style.display="block";
  listen();
}

function startGame(){
  db.ref("players").once("value",snap=>{
    const players=snap.val();
    const ids=Object.keys(players||{});
    if(ids.length<4) return alert("Minimum 4 players required");

    ids.forEach((id,i)=>{
      const role=roleOrder[i]||roleOrder[roleOrder.length-1];
      db.ref("players/"+id+"/role").set(role.name);
    });

    db.ref("status").set("Roles assigned. Rama, choose fast!");
    startTimer();
  });
}

function startTimer(){
  let t=20;
  db.ref("timer").set(t);
  timerInt=setInterval(()=>{
    t--;
    db.ref("timer").set(t);
    if(t<=0){
      clearInterval(timerInt);
      db.ref("ramaChoice").set("TIMEOUT");
    }
  },1000);
}

function selectSita(id){
  clearInterval(timerInt);
  db.ref("ramaChoice").set(id);
}

function leaveGame(){
  db.ref("players/"+uid).remove();
  location.reload();
}

function resetAllPlayers(){
  if(confirm("Reset all players?")){
    db.ref().remove();
    location.reload();
  }
}

function listen(){
  db.ref("players").on("value",snap=>{
    const p=snap.val();
    if(!p||!p[uid])return;

    document.getElementById("myrole").innerText =
      "You are: "+p[uid].role.toUpperCase();

    let txt="";
    for(let id in p){
      txt+=`${p[id].name} : ${p[id].score}<br>`;
    }
    document.getElementById("score").innerHTML=txt;

    if(p[uid].role==="rama"){
      document.getElementById("ramaPanel").style.display="block";
      const list=document.getElementById("playerList");
      list.innerHTML="";
      for(let id in p){
        if(id===uid)continue;
        const b=document.createElement("button");
        b.innerText=p[id].name;
        b.onclick=()=>selectSita(id);
        list.appendChild(b);
      }
    }
  });

  db.ref("timer").on("value",s=>{
    if(s.val()!=null)
      document.getElementById("timer").innerText="â± "+s.val()+"s left";
  });

  db.ref("ramaChoice").on("value",snap=>{
    const choice=snap.val();
    if(!choice)return;

    db.ref("players").once("value",ps=>{
      const players=ps.val();
      const correct = choice!=="TIMEOUT" && players[choice].role==="sita";

      for(let id in players){
        let role=players[id].role;
        let score=0;

        if(role==="rama") score=correct?1000:0;
        else if(role==="sita") score=correct?0:1000;
        else{
          const r=roleOrder.find(r=>r.name===role);
          score=r?r.score:0;
        }

        db.ref("players/"+id+"/score").set(score);
      }

      db.ref("status").set(
        correct ? "ðŸ¹ Rama found Sita!" : "ðŸŒ¸ Rama failed!"
      );

      db.ref("ramaChoice").remove();
      db.ref("timer").remove();
    });
  });

  db.ref("status").on("value",s=>{
    if(s.val())
      document.getElementById("status").innerText=s.val();
  });
}
</script>

</body>
</html>
