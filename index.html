<!DOCTYPE html>
<html>
<head>
  <title>Ramudu Sita Online Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <style>
    body{font-family:Arial;text-align:center;background:#ffe6cc}
    button{padding:10px 20px;margin:5px;font-size:16px}
    #game{display:none;margin-top:20px}
  </style>
</head>

<body>

<h2>ğŸ® Ramudu Sita Online Multiplayer</h2>

<input id="name" placeholder="Enter your name">
<button onclick="joinGame()">Join Game</button>

<div id="game">
  <h3 id="status"></h3>
  <button onclick="choose('rama')">I am Rama</button>
  <button onclick="choose('sita')">I am Sita</button>
  <h3 id="score"></h3>
</div>

<script>
/* ğŸ”´ REPLACE WITH YOUR REAL FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "PASTE",
  authDomain: "PASTE",
  databaseURL: "PASTE",
  projectId: "PASTE",
  appId: "PASTE"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let uid = "";
let playerName = "";
let role = "";

/* âœ… Anonymous login */
auth.signInAnonymously()
  .then(result => {
    uid = result.user.uid;
    console.log("Logged in:", uid);
  })
  .catch(err => alert(err.message));

/* âœ… Join game */
function joinGame(){
  if(uid === ""){
    alert("Please waitâ€¦ connecting");
    return;
  }

  playerName = document.getElementById("name").value;
  if(!playerName){
    alert("Enter name");
    return;
  }

  document.getElementById("game").style.display = "block";
  document.getElementById("status").innerText = "Waiting for players...";

  db.ref("players/" + uid).set({
    name: playerName,
    score: 0
  });

  listen();
}

/* âœ… Choose role */
function choose(r){
  role = r;
  db.ref("round/" + uid).set(role);
}

/* âœ… Game logic */
function listen(){
  db.ref("round").on("value", snap => {
    const data = snap.val();
    if(!data) return;

    const roles = Object.values(data);

    if(roles.includes("rama") && roles.includes("sita")){
      const ramaUid = Object.keys(data).find(k => data[k] === "rama");
      const sitaUid = Object.keys(data).find(k => data[k] === "sita");

      const winner = Math.random() > 0.5 ? "rama" : "sita";

      if(winner === "rama"){
        db.ref("players/" + ramaUid + "/score")
          .transaction(s => (s || 0) + 1000);
        document.getElementById("status").innerText = "ğŸ¹ Rama found Sita!";
      } else {
        db.ref("players/" + sitaUid + "/score")
          .transaction(s => (s || 0) + 1000);
        document.getElementById("status").innerText = "ğŸŒ¸ Sita escaped!";
      }

      db.ref("round").remove();
    }
  });

  db.ref("players").on("value", snap => {
    const data = snap.val();
    let txt = "ğŸ† Scores<br>";
    for(let p in data){
      txt += data[p].name + " : " + data[p].score + "<br>";
    }
    document.getElementById("score").innerHTML = txt;
  });
}
</script>

</body>
</html>
